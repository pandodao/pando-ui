{"version":3,"file":"passport.stories.b6d8e001.js","sources":["../../packages/passport/stories/Passport.tsx"],"sourcesContent":["/* eslint-disable vue/one-component-per-file */\nimport \"./Passport.scss\";\n\nimport { computed, defineComponent, ref, watch } from \"vue\";\nimport { VAvatar, VIcon, VImg, VSheet } from \"vuetify/components\";\nimport { FButton, FFiatDivision, FListItem } from \"@foxone/uikit/components\";\nimport { useToast } from \"@foxone/uikit/plugins/toast\";\nimport { usePassport } from \"@foxone/mixin-passport/lib/helper\";\nimport { v4 as uuid } from \"uuid\";\n\nexport const Passport = defineComponent({\n  name: \"Passport\",\n\n  props: {\n    authOptions: { type: Object },\n    paymentOptions: { type: Object },\n  },\n\n  setup(props) {\n    const token = ref(\"\");\n    const channel = ref(\"\");\n    const profile = ref<any>(null);\n    const assets = ref<any>([]);\n    const passport = usePassport();\n    const toast = useToast();\n    const loading = ref(false);\n\n    const connected = computed(() => Boolean(token.value && channel.value));\n\n    async function handleConnect() {\n      try {\n        const data = await passport.auth(props.authOptions as any);\n\n        token.value = data.token || data.keystore;\n        channel.value = data.channel;\n      } catch (error) {\n        console.log(error);\n      }\n    }\n\n    async function handleDisconnect() {\n      token.value = \"\";\n      channel.value = \"\";\n\n      localStorage.setItem(\"token\", \"\");\n      localStorage.setItem(\"channel\", \"\");\n    }\n\n    async function handlePayment() {\n      const traceId = uuid();\n      const options = {\n        ...props.paymentOptions,\n        traceId,\n        checker: async () => {\n          const resp = await fetch(\n            \"https://api.mixin.one/transfers/trace/\" + traceId,\n            {\n              method: \"GET\",\n              headers: {\n                Authorization: `Bearer ${token.value}`,\n              },\n            }\n          );\n          const json = await resp.json();\n\n          if (json.data) {\n            toast.success({ message: \"Payment checked\" });\n\n            return true;\n          } else {\n            return false;\n          }\n        },\n      };\n\n      passport.payment(options);\n    }\n\n    watch(\n      () => token.value,\n      async () => {\n        try {\n          profile.value = await passport.getProfile();\n          assets.value = await passport.getAssets([]);\n        } catch (error) {\n          console.log(error);\n        }\n      }\n    );\n\n    return () => (\n      <div class=\"passport-overvie-container\">\n        {loading.value || (\n          <div class=\"passport-overview\">\n            {connected.value ? (\n              <Connected\n                profile={profile.value}\n                assets={assets.value}\n                onDisconnect={() => handleDisconnect()}\n                onPayment={() => handlePayment()}\n              />\n            ) : (\n              <Disconnected onConnect={() => handleConnect()} />\n            )}\n          </div>\n        )}\n      </div>\n    );\n  },\n});\n\nconst Disconnected = defineComponent({\n  name: \"Disconnected2\",\n\n  emits: {\n    connect: () => true,\n  },\n\n  setup(props, { emit }) {\n    return () => (\n      <div class=\"passport-account-disconnected\">\n        <VIcon>$FIconWalletAFill</VIcon>\n\n        <div class=\"disconnected--hint\">Please connect your wallet first</div>\n\n        <FButton color=\"primary\" onClick={() => emit(\"connect\")}>\n          Connect Wallet\n        </FButton>\n      </div>\n    );\n  },\n});\n\nconst Connected = defineComponent({\n  name: \"Connected\",\n\n  props: {\n    profile: Object,\n    assets: Array,\n  },\n\n  emits: {\n    disconnect: () => true,\n    payment: () => true,\n  },\n\n  setup(props, { emit }) {\n    const name = computed(() => props.profile?.full_name);\n    const avatar = computed(() => props.profile?.avatar_url);\n    const balance = computed(() => {\n      const amount =\n        props.assets?.reduce(\n          (total: number, asset: any) =>\n            total + asset.balance * asset.price_usd,\n          0\n        ) ?? 0;\n\n      return new Intl.NumberFormat(\"en\", {\n        currency: \"USD\",\n        style: \"currency\",\n      }).formatToParts(amount);\n    });\n\n    return () => (\n      <div class=\"passport-account-connected\">\n        <VAvatar size=\"48\">\n          <VImg src={avatar.value} />\n        </VAvatar>\n\n        <div class=\"user-name mt-2\">\n          <span>{name.value}</span>\n        </div>\n\n        <VSheet theme=\"dark\" class=\"account-balance my-9\">\n          <div class=\"account-label mb-4\">Wallet Assets</div>\n\n          <FFiatDivision parts={balance.value} />\n        </VSheet>\n\n        <FListItem\n          height=\"56\"\n          title=\"Disconnect\"\n          prependIcon=\"$FIconDisconnect\"\n          class=\"text-error px-0\"\n          onClick={() => emit(\"disconnect\")}\n        />\n        <FListItem\n          height=\"56\"\n          title=\"Payment\"\n          prependIcon=\"$FIconBorrow\"\n          class=\"px-0\"\n          onClick={() => emit(\"payment\")}\n        />\n      </div>\n    );\n  },\n});\n"],"names":["Passport","defineComponent","name","props","authOptions","type","Object","paymentOptions","setup","token","ref","channel","profile","assets","passport","usePassport","toast","useToast","loading","connected","computed","Boolean","value","handleConnect","data","auth","keystore","error","console","log","handleDisconnect","localStorage","setItem","handlePayment","traceId","uuid","options","checker","fetch","method","headers","Authorization","json","success","message","payment","watch","getProfile","getAssets","_createVNode","Connected","onDisconnect","onPayment","Disconnected","onConnect","emits","connect","emit","VIcon","default","_createTextVNode","FButton","onClick","Array","disconnect","full_name","avatar","avatar_url","balance","amount","reduce","total","asset","price_usd","Intl","NumberFormat","currency","style","formatToParts","VAvatar","VImg","VSheet","FFiatDivision","FListItem"],"mappings":"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"}