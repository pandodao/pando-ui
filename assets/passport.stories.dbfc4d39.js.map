{"version":3,"file":"passport.stories.dbfc4d39.js","sources":["../../packages/passport/stories/Passport.tsx"],"sourcesContent":["/* eslint-disable vue/one-component-per-file */\nimport \"./Passport.scss\";\n\nimport { computed, defineComponent, onMounted, ref, watch } from \"vue\";\nimport { VAvatar, VIcon, VImg, VSheet } from \"vuetify/components\";\nimport { FButton, FFiatDivision, FListItem } from \"@foxone/uikit/components\";\nimport { useToast } from \"@foxone/uikit/plugins/toast\";\nimport { usePassport } from \"@foxone/mixin-passport/lib/helper\";\nimport { v4 as uuid } from \"uuid\";\n\nexport const Passport = defineComponent({\n  name: \"Passport\",\n\n  props: {\n    authOptions: { type: Object },\n    paymentOptions: { type: Object },\n  },\n\n  setup(props) {\n    const token = ref(\"\");\n    const channel = ref(\"\");\n    const profile = ref<any>(null);\n    const assets = ref<any>([]);\n    const passport = usePassport();\n    const toast = useToast();\n\n    const connected = computed(() => Boolean(token.value && channel.value));\n\n    async function handleConnect() {\n      const data = await passport.auth(props.authOptions as any);\n\n      token.value = data.token;\n      channel.value = data.channel;\n\n      localStorage.setItem(\"token\", data.token);\n      localStorage.setItem(\"channel\", data.channel);\n    }\n\n    async function handleDisconnect() {\n      token.value = \"\";\n      channel.value = \"\";\n\n      localStorage.setItem(\"token\", \"\");\n      localStorage.setItem(\"channel\", \"\");\n    }\n\n    async function handlePayment() {\n      const traceId = uuid();\n      const options = {\n        ...props.paymentOptions,\n        traceId,\n        checker: async () => {\n          const resp = await fetch(\n            \"https://api.mixin.one/transfers/trace/\" + traceId,\n            {\n              method: \"GET\",\n              headers: {\n                Authorization: `Bearer ${token.value}`,\n              },\n            }\n          );\n          const json = await resp.json();\n\n          if (json.data) {\n            toast.success({ message: \"Payment checked\" });\n\n            return true;\n          } else {\n            return false;\n          }\n        },\n      };\n\n      passport.payment(options);\n    }\n\n    watch(\n      () => token.value,\n      async () => {\n        profile.value = await passport.getProfile();\n        assets.value = await passport.getAssets();\n      }\n    );\n\n    onMounted(() => {\n      token.value = localStorage.getItem(\"token\") || \"\";\n      channel.value = localStorage.getItem(\"channel\") || \"\";\n\n      passport.sync({ token: token.value, channel: channel.value as any });\n    });\n\n    return () => (\n      <div class=\"passport-overvie-container\">\n        <div class=\"passport-overview\">\n          {connected.value ? (\n            <Connected\n              profile={profile.value}\n              assets={assets.value}\n              onDisconnect={() => handleDisconnect()}\n              onPayment={() => handlePayment()}\n            />\n          ) : (\n            <Disconnected onConnect={() => handleConnect()} />\n          )}\n        </div>\n      </div>\n    );\n  },\n});\n\nconst Disconnected = defineComponent({\n  name: \"Disconnected2\",\n\n  emits: {\n    connect: () => true,\n  },\n\n  setup(props, { emit }) {\n    return () => (\n      <div class=\"passport-account-disconnected\">\n        <VIcon>$FIconWalletAFill</VIcon>\n\n        <div class=\"disconnected--hint\">Please connect your wallet first</div>\n\n        <FButton color=\"primary\" onClick={() => emit(\"connect\")}>\n          Connect Wallet\n        </FButton>\n      </div>\n    );\n  },\n});\n\nconst Connected = defineComponent({\n  name: \"Connected\",\n\n  props: {\n    profile: Object,\n    assets: Array,\n  },\n\n  emits: {\n    disconnect: () => true,\n    payment: () => true,\n  },\n\n  setup(props, { emit }) {\n    const name = computed(() => props.profile?.full_name);\n    const avatar = computed(() => props.profile?.avatar_url);\n    const balance = computed(() => {\n      const amount =\n        props.assets?.reduce(\n          (total: number, asset: any) =>\n            total + asset.balance * asset.price_usd,\n          0\n        ) ?? 0;\n\n      return new Intl.NumberFormat(\"en\", {\n        currency: \"USD\",\n        style: \"currency\",\n      }).formatToParts(amount);\n    });\n\n    return () => (\n      <div class=\"passport-account-connected\">\n        <VAvatar size=\"48\">\n          <VImg src={avatar.value} />\n        </VAvatar>\n\n        <div class=\"user-name mt-2\">\n          <span>{name.value}</span>\n        </div>\n\n        <VSheet theme=\"dark\" class=\"account-balance my-9\">\n          <div class=\"account-label mb-4\">Wallet Assets</div>\n\n          <FFiatDivision parts={balance.value} />\n        </VSheet>\n\n        <FListItem\n          height=\"56\"\n          title=\"Disconnect\"\n          prependIcon=\"$FIconDisconnect\"\n          class=\"text-error px-0\"\n          onClick={() => emit(\"disconnect\")}\n        />\n        <FListItem\n          height=\"56\"\n          title=\"Payment\"\n          prependIcon=\"$FIconBorrow\"\n          class=\"px-0\"\n          onClick={() => emit(\"payment\")}\n        />\n      </div>\n    );\n  },\n});\n"],"names":["Passport","defineComponent","name","props","authOptions","type","Object","paymentOptions","setup","token","ref","channel","profile","assets","passport","usePassport","toast","useToast","connected","computed","Boolean","value","handleConnect","data","auth","localStorage","setItem","handleDisconnect","handlePayment","traceId","uuid","options","checker","fetch","method","headers","Authorization","json","success","message","payment","watch","getProfile","getAssets","onMounted","getItem","sync","_createVNode","Connected","Disconnected","emits","connect","emit","VIcon","_createTextVNode","FButton","Array","disconnect","full_name","avatar","avatar_url","balance","amount","reduce","total","asset","price_usd","Intl","NumberFormat","currency","style","formatToParts","VAvatar","VImg","VSheet","FFiatDivision","FListItem"],"mappings":"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"}