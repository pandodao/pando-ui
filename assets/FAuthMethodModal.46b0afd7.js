var P=Object.defineProperty;var r=(e,t)=>P(e,"name",{value:t,configurable:!0});import{A as v,b as z,a as o,e as B,U as M,r as g,o as q,m as C,d as G}from"./vue.esm-bundler.b09b7c5a.js";import{i as U}from"./mixin.87a49014.js";import{F as J}from"./FModal.edcf514e.js";import{b as K}from"./color.1fec8f8e.js";import{a as x}from"./locale.0dcd1420.js";import{u as w}from"./display.fd968d5a.js";import{V as N}from"./VImg.be2c1e9b.js";import{V as T}from"./VIcon.81f7ecc0.js";import{F as y}from"./FButton.fd5dc93c.js";import{g as Z}from"./helpers.c6c91249.js";import{i as _,R as W,u as Q,a as X,g as Y,B as ee,s as te,E as ne}from"./base64.852bad8a.js";import{F as oe}from"./FQRCode.90f45892.js";import{V as se}from"./VProgressCircular.8c9797f0.js";const ae=v({name:"FAuthStep1",inheritAttrs:!1,props:{step:{type:Number,default:1},method:{type:String,default:""},authMethods:{type:Array,default:()=>["mixin"]},authMethodState:{type:Object,default:()=>({})}},emits:{close:()=>!0,auth:e=>!0,"update:method":e=>!0,"update:step":e=>!0},setup(e,{emit:t}){const{t:i}=x(),{mdAndUp:n}=w(),a=K(),l=a.current.value.colors.greyscale_3,d=z(()=>a.name.value==="dark"),f=[{needNextStep:!e.authMethodState.metamask,value:"metamask",title:"MetaMask",bg:d.value?l:"#FFEEDD",logo:"https://static.fox.one/image/logo_metamask@40x40.png"},{needNextStep:!0,value:"mixin",title:"Mixin",bg:d.value?l:"#EBF8FF",logo:"https://static.fox.one/image/logo_mixin@40x40.png"},{needNextStep:!e.authMethodState.fennec,value:"fennec",title:"Fennec",bg:d.value?l:"#E6E7FD",logo:"https://static.fox.one/image/logo_fennec@40x40.png"},{needNextStep:!1,value:"walletconnect",title:"WalletConnect",bg:d.value?l:"#f5f5f5",logo:d.value?"https://static.fox.one/image/logo_walletconnect_dark@40x40.png":"https://static.fox.one/image/logo_walletconnect@40x40.png"},{needNextStep:!e.authMethodState.onekey,value:"onekey",title:"OneKey",bg:d.value?l:"#E9FEE6",logo:"https://static.fox.one/image/logo_onekey@40x40.png"}],h=r(()=>e.authMethods.map(u=>f.find(k=>k.value===u)).filter(u=>!!u),"getAuthMethodsMeta"),c=r(u=>{u.needNextStep?(t("update:method",u.value),t("update:step",2)):(t("close"),t("auth",{type:u.value}))},"handleAuth");return()=>o("div",{class:"f-auth-step1"},[o("div",{class:["f-auth-methods",{"f-auth-methods--mobile":!n.value}]},[h().map(u=>o("div",{key:u.value,style:{backgroundColor:u.bg},class:"f-auth-method",onClick:()=>c(u)},[o("span",{class:"f-auth-method__logo"},[o(N,{width:"40",height:"40",src:u.logo},null)]),o("span",{class:"f-auth-method__label"},[u.title])]))]),o("div",{class:"f-auth-hint"},[o(T,{size:"16",color:"warning",class:"f-auth-hint__horn"},{default:()=>[B("$horn")]}),o("span",{innerHTML:i("$vuetify.uikit.gas_fee_hint")},null)])])}});function ie(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!M(e)}r(ie,"_isSlot$2");const le=v({name:"FAuthFennecInstall",inheritAttrs:!1,setup(){const{smAndDown:e}=w(),{t}=x(),i=r(()=>{const n=Z()==="firefox"?"https://addons.mozilla.org/firefox/addon/fox_fennec":"https://chrome.google.com/webstore/detail/fennec/eincngenkhohbbfpkohipekcmnkfamjp";window.open(n)},"handleInstall");return()=>{let n;return o("div",{class:["f-auth-fennec","f-auth-step2",{"f-auth-step2--small":e.value}]},[o("div",{class:"f-auth-step2__left"},null),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title"},[t("$vuetify.uikit.fennec_not_installed")]),o("div",{class:"f-auth-step2__subtitle"},[t("$vuetify.uikit.fennec_introduction")]),o(y,{color:"greyscale_1",onClick:i},ie(n=t("$vuetify.uikit.install"))?n:{default:()=>[n]})])])}}}),ue=v({name:"FAuthMetamaskInstall",inheritAttrs:!1,setup(){const{smAndDown:e}=w(),{t}=x(),i=r(()=>{const n="https://metamask.io/download/";window.open(n)},"handleInstall");return()=>o("div",{class:["f-auth-metamask","f-auth-step2",{"f-auth-step2--small":e.value,"f-auth-metamask--mobile":!_()}]},[o("div",{class:"f-auth-step2__left"},null),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title",innerHTML:_()?t("$vuetify.uikit.metamask_not_installed"):t("$vuetify.uikit.metamask_not_installed_2")},null),o("div",{class:"f-auth-step2__subtitle",innerHTML:_()?t("$vuetify.uikit.metamask_introduction"):t("$vuetify.uikit.metamask_introduction_2")},null),o(y,{color:"greyscale_1",onClick:i,innerHTML:_()?t("$vuetify.uikit.install"):t("$vuetify.uikit.open_in_mixin")},null)])])}});function V(e,t){this.api=e,this.endpoint=t}r(V,"MixinClient");V.prototype={disconnect(){this.ws.close()},connect(e,t,i,n){const a=this;a.handled=!1,a.callback=e,a.ws=new W(a.endpoint,"Mixin-OAuth-1",{maxReconnectionDelay:5e3,minReconnectionDelay:1e3,reconnectionDelayGrowFactor:1.2,connectionTimeout:8e3,maxRetries:1/0,debug:!1}),a.ws.addEventListener("message",function(l){if(a.handled)return;const d=new FileReader;d.onload=function(){const f=Q(new Uint8Array(this.result),{to:"string"}),h=JSON.parse(f);if(a.callback(h)){a.handled=!0;return}setTimeout(function(){a.sendRefreshCode(t,i,n,h.data)},1e3)},d.readAsArrayBuffer(l.data)}),a.ws.addEventListener("open",function(l){a.sendRefreshCode(t,i,n)})},sendRefreshCode(e,t,i,n){const a=this;a.handled||a.send({id:X.v4().toUpperCase(),action:"REFRESH_OAUTH_CODE",params:{client_id:e,scope:t,code_challenge:i,authorization_id:n?n.authorization_id:""}})},send(e){try{this.ws.send(Y(JSON.stringify(e)))}catch(t){t instanceof DOMException||console.error(t)}}};function R(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}r(R,"base64URLEncode");function re(e){let t="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t}r(re,"generateRandomString");function ce(){const e=re(32),t=R(ee.encode(e)),i=R(te(e).toString(ne));return{verifier:t,challenge:i}}r(ce,"generateCodePair");function H(e,t=!1,i,n={}){const[a,l]=t?["https://xuexi-api.firesbox.com","wss://xuexi-blaze.firesbox.com"]:["https://api.mixin.one","wss://blaze.mixin.one"],d=i[0]||a,f=i[1]||l,h=new V(d,f);let c=!1;const{challenge:u="",verifier:k=""}=e.pkce?ce():{},A=r(s=>{var S,F,E,$,b;const p=s.data;if(((S=s==null?void 0:s.error)==null?void 0:S.code)===400||((F=s==null?void 0:s.error)==null?void 0:F.code)===10002)return(E=n.onError)==null||E.call(n,s==null?void 0:s.error),!0;if(!p)return!1;if(p.authorization_code.length>16)return e.pkce?fetch(d+"/oauth/token",{method:"post",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:e.clientId,code_verifier:k,code:p.authorization_code})}).then(m=>m.json()).then(m=>{var L,O,D;const I=(L=m==null?void 0:m.data)==null?void 0:L.access_token;I?(O=n.onSuccess)==null||O.call(n,I):(D=n.onError)==null||D.call(n,{description:"Get PKCE access token error"})}).catch(()=>{var m;(m=n.onError)==null||m.call(n,{description:"Get PKCE access token error"})}):($=n.onSuccess)==null||$.call(n,p.authorization_code),!0;if(U()){if(c)return!1;window.location.href="mixin://codes/"+p.code_id,c=!0}else(b=n.onShowUrl)==null||b.call(n,"mixin://codes/"+p.code_id);return!1},"handler");return h.connect(A,e.clientId,e.scope,u),h}r(H,"authorize");function j(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!M(e)}r(j,"_isSlot$1");const de=v({name:"FAuthMixinMessenger",inheritAttrs:!1,props:{clientId:{type:String,default:""},scope:{type:String,default:""},pkce:{type:Boolean,default:!1},isFiresbox:{type:Boolean,default:!1},hosts:{type:Array,default:()=>[]}},emits:{auth:e=>!0,error:e=>!0,close:()=>!0},setup(e,{attrs:t,emit:i}){const{smAndDown:n}=w(),{t:a}=x(),l=g(""),d=g(null),f=r(()=>{const c="https://mixin.one/mm";window.open(c)},"handleInstall"),h=r(()=>{window.location.href=l.value},"handleOpenInApp");return q(()=>{d.value=H({clientId:e.clientId,scope:e.scope,pkce:e.pkce},e.isFiresbox,e.hosts,{onShowUrl:c=>l.value=c,onError:c=>i("error",c),onSuccess:c=>{var u;i("close"),(u=d.value)==null||u.disconnect(),e.pkce?i("auth",{type:"mixin",token:c}):i("auth",{type:"mixin",code:c})}})}),()=>{let c,u;return o("div",{class:`f-auth-mixin f-auth-step2 ${n.value&&"f-auth-step2--small"}`},[o("div",{class:"f-auth-step2__left"},[l.value?o("div",{class:"f-auth-step2__qr-wrapper"},[o(oe,{class:"f-auth-step2__qr-code",text:l.value,size:182},null),o(N,{class:"f-auth-step2__qr-logo",height:"32",width:"32",src:"https://static.fox.one/image/icon_mixin@32x32.png"},null)]):o(se,{width:3,indeterminate:!0,color:"black",class:"d-flex f-auth-step2__loading"},null)]),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title"},[a("$vuetify.uikit.scan_to_connect")]),o("div",{class:"f-auth-step2__subtitle"},[o("span",{innerHTML:a("$vuetify.uikit.mixin_connect_detail",["<a class='f-auth-step2__link' href='https://mixin.one/messenger'>Mixin Messenger<svg width='14' height='14' viewBox='0 0 14 14' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M12.2068 1.79276C10.2975 -0.116585 7.2018 -0.116585 5.29246 1.79276L4.64288 2.44234C4.25236 2.83286 4.25236 3.46603 4.64288 3.85655C5.03341 4.24707 5.66657 4.24707 6.0571 3.85655L6.70667 3.20698C7.83497 2.07868 9.6643 2.07868 10.7926 3.20698C11.9209 4.33528 11.9209 6.16461 10.7926 7.29291L10.1425 7.94304C9.75195 8.33357 9.75194 8.96673 10.1425 9.35726C10.533 9.74778 11.1662 9.74778 11.5567 9.35726L12.2068 8.70712C14.1162 6.79778 14.1162 3.70211 12.2068 1.79276Z' fill='#076aff'/><path d='M3.85726 6.05638C4.24779 5.66586 4.24779 5.03269 3.85726 4.64217C3.46674 4.25165 2.83357 4.25165 2.44305 4.64217L1.79236 5.29286C-0.116985 7.2022 -0.116985 10.2979 1.79236 12.2072C3.70171 14.1166 6.79738 14.1166 8.70672 12.2072L9.35713 11.5568C9.74765 11.1663 9.74765 10.5331 9.35713 10.1426C8.9666 9.75207 8.33344 9.75207 7.94291 10.1426L7.29251 10.793C6.16421 11.9213 4.33488 11.9213 3.20658 10.793C2.07828 9.6647 2.07828 7.83537 3.20658 6.70707L3.85726 6.05638Z' fill='#076aff'/><path d='M8.20674 7.2071C8.59727 6.81658 8.59727 6.18341 8.20674 5.79289C7.81622 5.40237 7.18305 5.40237 6.79253 5.79289L5.73187 6.85355C5.34134 7.24408 5.34134 7.87724 5.73187 8.26776C6.12239 8.65829 6.75556 8.65829 7.14608 8.26776L8.20674 7.2071Z' fill='#076aff'/></svg></a>"])},null)]),o("div",{class:"f-auth-step2__actions"},[o(y,{color:"greyscale_1",onClick:h},j(c=a("$vuetify.uikit.open_in_mixin"))?c:{default:()=>[c]}),o(y,{color:"greyscale_6",onClick:f},j(u=a("$vuetify.uikit.install"))?u:{default:()=>[u]})])])])}}});function fe(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!M(e)}r(fe,"_isSlot");const he=v({name:"FAuthOnekeyInstall",inheritAttrs:!1,setup(){const{smAndDown:e}=w(),{t}=x(),i=r(()=>{const n="https://onekey.so/download?client=browserExtension";window.open(n)},"handleInstall");return()=>{let n;return o("div",{class:["f-auth-onekey","f-auth-step2",{"f-auth-step2--small":e.value,"f-auth-onekey--mobile":!_}]},[o("div",{class:"f-auth-step2__left"},null),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title",innerHTML:_()?t("$vuetify.uikit.onekey_not_installed"):t("$vuetify.uikit.onekey_not_installed_2")},null),o("div",{class:"f-auth-step2__subtitle",innerHTML:_()?t("$vuetify.uikit.onekey_introduction"):t("$vuetify.uikit.onekey_introduction_2")},null),o(y,{color:"greyscale_1",onClick:i},fe(n=t("$vuetify.uikit.install"))?n:{default:()=>[n]})])])}}}),pe=v({name:"FAuthStep2",inheritAttrs:!1,props:{method:{type:String,default:""},clientId:{type:String,default:""},scope:{type:String,default:""},pkce:{type:Boolean,default:!1},isFiresbox:{type:Boolean,default:!1},hosts:{type:Array,default:()=>[]}},emits:{"update:step":e=>!0,auth:e=>!0,error:e=>!0,close:()=>!0},setup(e,{emit:t,attrs:i}){const n=r(()=>{switch(e.method){case"fennec":return le;case"metamask":return ue;case"onekey":return he;default:return de}},"getComponent"),a=z(()=>({wrapper:n()}));return()=>o("div",{class:"f-auth-step2"},[o(a.value.wrapper,C(e,{onAuth:l=>t("auth",l),onError:l=>t("error",l),onClose:()=>t("close")}),null),o(y,{icon:!0,size:"32",class:"f-auth-step2__back",onClick:()=>t("update:step",1)},{default:()=>[o(T,{color:"black"},{default:()=>[B("$back")]})]})])}}),$e=v({name:"FAuthMethodModal",inheritAttrs:!1,props:{authMethods:{type:Array,default:()=>["mixin"]},authMethodState:{type:Object,default:()=>({})},clientId:{type:String,default:""},scope:{type:String,default:""},isFiresbox:{type:Boolean,default:!1},hosts:{type:Array,default:()=>[]},pkce:{type:Boolean,default:!1}},emits:{auth:e=>!0,error:e=>!0,destroy:()=>!0},setup(e,{emit:t,expose:i}){const{t:n}=x(),a=g(!1),l=g(1),d=g(null),f=g(""),h=r(()=>o("div",{class:"f-auth-methods__wrapper"},[l.value===1?o(ae,C(e,{step:l.value,"onUpdate:step":s=>l.value=s,method:f.value,"onUpdate:method":s=>f.value=s,onClose:c,onAuth:s=>t("auth",s),onError:s=>t("error",s)}),null):o(pe,C(e,{step:l.value,"onUpdate:step":s=>l.value=s,method:f.value,"onUpdate:method":s=>f.value=s,onClose:c,onAuth:s=>t("auth",s),onError:s=>t("error",s)}),null)]),"content"),c=r(()=>{a.value=!1},"close"),u=r(s=>{var p;s||(l.value=1,f.value="",a.value=!1,c(),t("destroy"),(p=d.value)==null||p.disconnect())},"handleDialogChange"),k=r(s=>{a.value=s,t("error",new Error("Cancelled"))},"handleModalValueChange");return G(()=>a.value,u),i({show:r(()=>{U()&&e.authMethods.includes("mixin")?d.value=H({clientId:e.clientId,scope:e.scope,pkce:e.pkce},e.isFiresbox,e.hosts,{onError:s=>t("error",s),onSuccess:s=>{e.pkce?t("auth",{type:"mixin",token:s}):t("auth",{type:"mixin",code:s})}}):a.value=!0},"show"),close:c}),()=>o(J,{modelValue:a.value,title:l.value===1?n("$vuetify.uikit.connect_wallet"):"","max-width":"628","onUpdate:modelValue":k},{default:()=>h()})}});export{$e as F};
//# sourceMappingURL=FAuthMethodModal.46b0afd7.js.map
