var W=Object.defineProperty;var r=(e,t)=>W(e,"name",{value:t,configurable:!0});import{D as v,b as U,a as o,e as V,R as M,r as g,o as Q,m as C,d as X}from"./vue.esm-bundler.80cafc0b.js";import{i as H}from"./mixin.779267f9.js";import{F as Y}from"./FModal.ac7dde43.js";import{f as ee}from"./color.7ba4ffe3.js";import{V as P}from"./VImg.78b97665.js";import{a as w}from"./locale.68d0262d.js";import{u as k}from"./display.1ed39e23.js";import{V as q}from"./VIcon.ac9f05d6.js";import{F as x}from"./FButton.5e8d1e13.js";import{g as te}from"./helpers.c6c91249.js";import{i as _,R as ne,u as oe,a as ie,g as se,B as ae,s as le,E as ue}from"./base64.cdc5cb9c.js";import{F as re}from"./FQRCode.76df491d.js";import{V as ce}from"./VProgressCircular.fec55325.js";const de=v({name:"FAuthStep1",inheritAttrs:!1,props:{step:{type:Number,default:1},method:{type:String,default:""},authMethods:{type:Array,default:()=>["mixin"]},authMethodState:{type:Object,default:()=>({})}},emits:{close:()=>!0,auth:e=>!0,"update:method":e=>!0,"update:step":e=>!0},setup(e,{emit:t}){const{t:a}=w(),{mdAndUp:n}=k(),s=ee(),l=s.current.value.colors.greyscale_3,d=U(()=>s.name.value==="dark"),h=[{needNextStep:!e.authMethodState.metamask,value:"metamask",title:"MetaMask",bg:d.value?l:"#FFEEDD",logo:"https://static.fox.one/image/logo_metamask@40x40.png"},{needNextStep:!0,value:"mixin",title:"Mixin",bg:d.value?l:"#EBF8FF",logo:"https://static.fox.one/image/logo_mixin@40x40.png"},{needNextStep:!e.authMethodState.fennec,value:"fennec",title:"Fennec",bg:d.value?l:"#E6E7FD",logo:"https://static.fox.one/image/logo_fennec@40x40.png"},{needNextStep:!1,value:"walletconnect",title:"WalletConnect",bg:d.value?l:"#f5f5f5",logo:d.value?"https://static.fox.one/image/logo_walletconnect_dark@40x40.png":"https://static.fox.one/image/logo_walletconnect@40x40.png"},{needNextStep:!e.authMethodState.onekey,value:"onekey",title:"OneKey",bg:d.value?l:"#E9FEE6",logo:"https://static.fox.one/image/logo_onekey@40x40.png"}],p=r(()=>e.authMethods.map(u=>h.find(m=>m.value===u)).filter(u=>!!u),"getAuthMethodsMeta"),c=r(u=>{u.needNextStep?(t("update:method",u.value),t("update:step",2)):(t("close"),t("auth",{type:u.value}))},"handleAuth");return()=>o("div",{class:"f-auth-step1"},[o("div",{class:["f-auth-methods",{"f-auth-methods--mobile":!n.value}]},[p().map(u=>o("div",{key:u.value,style:{backgroundColor:u.bg},class:"f-auth-method",onClick:()=>c(u)},[o("span",{class:"f-auth-method__logo"},[o(P,{width:"40",height:"40",src:u.logo},null)]),o("span",{class:"f-auth-method__label"},[u.title])]))]),o("div",{class:"f-auth-hint"},[o(q,{size:"16",color:"warning",class:"f-auth-hint__horn"},{default:()=>[V("$horn")]}),o("span",{innerHTML:a("$vuetify.uikit.gas_fee_hint")},null)])])}});function fe(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!M(e)}r(fe,"_isSlot$2");const he=v({name:"FAuthFennecInstall",inheritAttrs:!1,setup(){const{smAndDown:e}=k(),{t}=w(),a=r(()=>{const n=te()==="firefox"?"https://addons.mozilla.org/firefox/addon/fox_fennec":"https://chrome.google.com/webstore/detail/fennec/eincngenkhohbbfpkohipekcmnkfamjp";window.open(n)},"handleInstall");return()=>{let n;return o("div",{class:["f-auth-fennec","f-auth-step2",{"f-auth-step2--small":e.value}]},[o("div",{class:"f-auth-step2__left"},null),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title"},[t("$vuetify.uikit.fennec_not_installed")]),o("div",{class:"f-auth-step2__subtitle"},[t("$vuetify.uikit.fennec_introduction")]),o(x,{color:"greyscale_1",onClick:a},fe(n=t("$vuetify.uikit.install"))?n:{default:()=>[n]})])])}}}),pe=v({name:"FAuthMetamaskInstall",inheritAttrs:!1,setup(){const{smAndDown:e}=k(),{t}=w(),a=r(()=>{const n="https://metamask.io/download/";window.open(n)},"handleInstall");return()=>o("div",{class:["f-auth-metamask","f-auth-step2",{"f-auth-step2--small":e.value,"f-auth-metamask--mobile":!_()}]},[o("div",{class:"f-auth-step2__left"},null),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title",innerHTML:_()?t("$vuetify.uikit.metamask_not_installed"):t("$vuetify.uikit.metamask_not_installed_2")},null),o("div",{class:"f-auth-step2__subtitle",innerHTML:_()?t("$vuetify.uikit.metamask_introduction"):t("$vuetify.uikit.metamask_introduction_2")},null),o(x,{color:"greyscale_1",onClick:a,innerHTML:_()?t("$vuetify.uikit.install"):t("$vuetify.uikit.open_in_mixin")},null)])])}});function G(e,t){this.api=e,this.endpoint=t}r(G,"MixinClient");G.prototype={disconnect(){this.ws.close()},connect(e,t,a,n){const s=this;s.handled=!1,s.callback=e,s.ws=new ne(s.endpoint,"Mixin-OAuth-1",{maxReconnectionDelay:5e3,minReconnectionDelay:1e3,reconnectionDelayGrowFactor:1.2,connectionTimeout:8e3,maxRetries:1/0,debug:!1}),s.ws.addEventListener("message",function(l){if(s.handled)return;const d=new FileReader;d.onload=function(){const h=oe(new Uint8Array(this.result),{to:"string"}),p=JSON.parse(h);if(s.callback(p)){s.handled=!0;return}setTimeout(function(){s.sendRefreshCode(t,a,n,p.data)},1e3)},d.readAsArrayBuffer(l.data)}),s.ws.addEventListener("open",function(l){s.sendRefreshCode(t,a,n)})},sendRefreshCode(e,t,a,n){const s=this;s.handled||s.send({id:ie.v4().toUpperCase(),action:"REFRESH_OAUTH_CODE",params:{client_id:e,scope:t,code_challenge:a,authorization_id:n?n.authorization_id:""}})},send(e){try{this.ws.send(se(JSON.stringify(e)))}catch(t){t instanceof DOMException||console.error(t)}}};function N(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}r(N,"base64URLEncode");function ye(e){let t="";const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}r(ye,"generateRandomString");function _e(){const e=ye(32),t=N(ae.encode(e)),a=N(le(e).toString(ue));return{verifier:t,challenge:a}}r(_e,"generateCodePair");function J(e,t=!1,a,n={}){const[s,l]=t?["https://xuexi-api.firesbox.com","wss://xuexi-blaze.firesbox.com"]:["https://api.mixin.one","wss://blaze.mixin.one"],d=a[0]||s,h=a[1]||l,p=new G(d,h);let c=!1;const{challenge:u="",verifier:m=""}=e.pkce?_e():{},A=r(i=>{var F,E,K,I,$;const y=i.data;if(((F=i==null?void 0:i.error)==null?void 0:F.code)===400||((E=i==null?void 0:i.error)==null?void 0:E.code)===10002)return(K=n.onError)==null||K.call(n,i==null?void 0:i.error),!0;if(!y)return!1;if(y.authorization_code.length>16){if(e.pkce){const Z=e.useEd25519KeyStore?{client_id:e.clientId,code_verifier:m,code:y.authorization_code,ed25519:e.publicKey}:{client_id:e.clientId,code_verifier:m,code:y.authorization_code};fetch(d+"/oauth/token",{method:"post",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(Z)}).then(f=>f.json()).then(f=>{var b,L,D,O,z,B,R;if(e.useEd25519KeyStore){const S=(b=f==null?void 0:f.data)==null?void 0:b.scope,j=(L=f==null?void 0:f.data)==null?void 0:L.authorization_id;!S||!j?(D=n.onError)==null||D.call(n,{description:"Access Denied"}):(O=n.onSuccess)==null||O.call(n,{keystore:{user_id:e.clientId,scope:S,authorization_id:j,private_key:e.privateKey}})}else{const S=(z=f==null?void 0:f.data)==null?void 0:z.access_token;S?(B=n.onSuccess)==null||B.call(n,{token:S}):(R=n.onError)==null||R.call(n,{description:"Get PKCE access token error"})}}).catch(()=>{var f;(f=n.onError)==null||f.call(n,{description:"Get PKCE access token error"})})}else(I=n.onSuccess)==null||I.call(n,{code:y.authorization_code});return!0}if(H()){if(c)return!1;window.location.href="mixin://codes/"+y.code_id,c=!0}else($=n.onShowUrl)==null||$.call(n,"mixin://codes/"+y.code_id);return!1},"handler");return p.connect(A,e.clientId,e.scope,u),p}r(J,"authorize");function T(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!M(e)}r(T,"_isSlot$1");const ve=v({name:"FAuthMixinMessenger",inheritAttrs:!1,props:{clientId:{type:String,default:""},scope:{type:String,default:""},pkce:{type:Boolean,default:!1},useEd25519KeyStore:{type:Boolean,default:!1},publicKey:{type:String,default:""},privateKey:{type:String,default:""},isFiresbox:{type:Boolean,default:!1},hosts:{type:Array,default:()=>[]}},emits:{auth:e=>!0,error:e=>!0,close:()=>!0},setup(e,{attrs:t,emit:a}){const{smAndDown:n}=k(),{t:s}=w(),l=g(""),d=g(null),h=r(()=>{const c="https://mixin.one/mm";window.open(c)},"handleInstall"),p=r(()=>{window.location.href=l.value},"handleOpenInApp");return Q(()=>{d.value=J({clientId:e.clientId,scope:e.scope,pkce:e.pkce,useEd25519KeyStore:e.useEd25519KeyStore,publicKey:e.publicKey,privateKey:e.privateKey},e.isFiresbox,e.hosts,{onShowUrl:c=>l.value=c,onError:c=>a("error",c),onSuccess:c=>{var u;a("close"),(u=d.value)==null||u.disconnect(),a("auth",{type:"mixin",...c})}})}),()=>{let c,u;return o("div",{class:`f-auth-mixin f-auth-step2 ${n.value&&"f-auth-step2--small"}`},[o("div",{class:"f-auth-step2__left"},[l.value?o("div",{class:"f-auth-step2__qr-wrapper"},[o(re,{class:"f-auth-step2__qr-code",text:l.value,size:182},null),o(P,{class:"f-auth-step2__qr-logo",height:"32",width:"32",src:"https://static.fox.one/image/icon_mixin@32x32.png"},null)]):o(ce,{width:3,indeterminate:!0,color:"black",class:"d-flex f-auth-step2__loading"},null)]),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title"},[s("$vuetify.uikit.scan_to_connect")]),o("div",{class:"f-auth-step2__subtitle"},[o("span",{innerHTML:s("$vuetify.uikit.mixin_connect_detail",["<a class='f-auth-step2__link' href='https://mixin.one/messenger'>Mixin Messenger<svg width='14' height='14' viewBox='0 0 14 14' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M12.2068 1.79276C10.2975 -0.116585 7.2018 -0.116585 5.29246 1.79276L4.64288 2.44234C4.25236 2.83286 4.25236 3.46603 4.64288 3.85655C5.03341 4.24707 5.66657 4.24707 6.0571 3.85655L6.70667 3.20698C7.83497 2.07868 9.6643 2.07868 10.7926 3.20698C11.9209 4.33528 11.9209 6.16461 10.7926 7.29291L10.1425 7.94304C9.75195 8.33357 9.75194 8.96673 10.1425 9.35726C10.533 9.74778 11.1662 9.74778 11.5567 9.35726L12.2068 8.70712C14.1162 6.79778 14.1162 3.70211 12.2068 1.79276Z' fill='#076aff'/><path d='M3.85726 6.05638C4.24779 5.66586 4.24779 5.03269 3.85726 4.64217C3.46674 4.25165 2.83357 4.25165 2.44305 4.64217L1.79236 5.29286C-0.116985 7.2022 -0.116985 10.2979 1.79236 12.2072C3.70171 14.1166 6.79738 14.1166 8.70672 12.2072L9.35713 11.5568C9.74765 11.1663 9.74765 10.5331 9.35713 10.1426C8.9666 9.75207 8.33344 9.75207 7.94291 10.1426L7.29251 10.793C6.16421 11.9213 4.33488 11.9213 3.20658 10.793C2.07828 9.6647 2.07828 7.83537 3.20658 6.70707L3.85726 6.05638Z' fill='#076aff'/><path d='M8.20674 7.2071C8.59727 6.81658 8.59727 6.18341 8.20674 5.79289C7.81622 5.40237 7.18305 5.40237 6.79253 5.79289L5.73187 6.85355C5.34134 7.24408 5.34134 7.87724 5.73187 8.26776C6.12239 8.65829 6.75556 8.65829 7.14608 8.26776L8.20674 7.2071Z' fill='#076aff'/></svg></a>"])},null)]),o("div",{class:"f-auth-step2__actions"},[o(x,{color:"greyscale_1",onClick:p},T(c=s("$vuetify.uikit.open_in_mixin"))?c:{default:()=>[c]}),o(x,{color:"greyscale_6",onClick:h},T(u=s("$vuetify.uikit.install"))?u:{default:()=>[u]})])])])}}});function me(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!M(e)}r(me,"_isSlot");const ge=v({name:"FAuthOnekeyInstall",inheritAttrs:!1,setup(){const{smAndDown:e}=k(),{t}=w(),a=r(()=>{const n="https://onekey.so/download?client=browserExtension";window.open(n)},"handleInstall");return()=>{let n;return o("div",{class:["f-auth-onekey","f-auth-step2",{"f-auth-step2--small":e.value,"f-auth-onekey--mobile":!_}]},[o("div",{class:"f-auth-step2__left"},null),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title",innerHTML:_()?t("$vuetify.uikit.onekey_not_installed"):t("$vuetify.uikit.onekey_not_installed_2")},null),o("div",{class:"f-auth-step2__subtitle",innerHTML:_()?t("$vuetify.uikit.onekey_introduction"):t("$vuetify.uikit.onekey_introduction_2")},null),o(x,{color:"greyscale_1",onClick:a},me(n=t("$vuetify.uikit.install"))?n:{default:()=>[n]})])])}}}),xe=v({name:"FAuthStep2",inheritAttrs:!1,props:{method:{type:String,default:""},clientId:{type:String,default:""},scope:{type:String,default:""},pkce:{type:Boolean,default:!1},useEd25519KeyStore:{type:Boolean,default:!1},publicKey:{type:String,default:""},privateKey:{type:String,default:""},isFiresbox:{type:Boolean,default:!1},hosts:{type:Array,default:()=>[]}},emits:{"update:step":e=>!0,auth:e=>!0,error:e=>!0,close:()=>!0},setup(e,{emit:t,attrs:a}){const n=r(()=>{switch(e.method){case"fennec":return he;case"metamask":return pe;case"onekey":return ge;default:return ve}},"getComponent"),s=U(()=>({wrapper:n()}));return()=>o("div",{class:"f-auth-step2"},[o(s.value.wrapper,C(e,{onAuth:l=>t("auth",l),onError:l=>t("error",l),onClose:()=>t("close")}),null),o(x,{icon:!0,size:"32",class:"f-auth-step2__back",onClick:()=>t("update:step",1)},{default:()=>[o(q,{color:"black"},{default:()=>[V("$back")]})]})])}}),Oe=v({name:"FAuthMethodModal",inheritAttrs:!1,props:{authMethods:{type:Array,default:()=>["mixin"]},authMethodState:{type:Object,default:()=>({})},clientId:{type:String,default:""},scope:{type:String,default:""},isFiresbox:{type:Boolean,default:!1},hosts:{type:Array,default:()=>[]},pkce:{type:Boolean,default:!1},useEd25519KeyStore:{type:Boolean,default:!1},publicKey:{type:String,default:""},privateKey:{type:String,default:""}},emits:{auth:e=>!0,error:e=>!0,destroy:()=>!0},setup(e,{emit:t,expose:a}){const{t:n}=w(),s=g(!1),l=g(1),d=g(null),h=g(""),p=r(()=>o("div",{class:"f-auth-methods__wrapper"},[l.value===1?o(de,C(e,{step:l.value,"onUpdate:step":i=>l.value=i,method:h.value,"onUpdate:method":i=>h.value=i,onClose:c,onAuth:i=>t("auth",i),onError:i=>t("error",i)}),null):o(xe,C(e,{step:l.value,"onUpdate:step":i=>l.value=i,method:h.value,"onUpdate:method":i=>h.value=i,onClose:c,onAuth:i=>t("auth",i),onError:i=>t("error",i)}),null)]),"content"),c=r(()=>{s.value=!1},"close"),u=r(i=>{var y;i||(l.value=1,h.value="",s.value=!1,c(),t("destroy"),(y=d.value)==null||y.disconnect())},"handleDialogChange"),m=r(i=>{s.value=i,t("error",new Error("Cancelled"))},"handleModalValueChange");return X(()=>s.value,u),a({show:r(()=>{H()&&e.authMethods.includes("mixin")?d.value=J({clientId:e.clientId,scope:e.scope,pkce:e.pkce,useEd25519KeyStore:e.useEd25519KeyStore,publicKey:e.publicKey,privateKey:e.privateKey},e.isFiresbox,e.hosts,{onError:i=>t("error",i),onSuccess:i=>{t("auth",{type:"mixin",...i})}}):s.value=!0},"show"),close:c}),()=>o(Y,{modelValue:s.value,title:l.value===1?n("$vuetify.uikit.connect_wallet"):"","max-width":"628","onUpdate:modelValue":m},{default:()=>p()})}});export{Oe as F};
//# sourceMappingURL=FAuthMethodModal.f79a2ac6.js.map
