var P=Object.defineProperty;var c=(e,t)=>P(e,"name",{value:t,configurable:!0});import{A as v,b as z,a as o,e as B,W as A,r as y,o as q,m as M,d as G}from"./vue.esm-bundler.1ba604f9.js";import{i as N}from"./mixin.87a49014.js";import{F as J}from"./FModal.3e0c2496.js";import{b as K}from"./color.b891a321.js";import{a as w}from"./locale.fb27b96c.js";import{u as k}from"./display.de7ed398.js";import{V as T}from"./VImg.2750fab4.js";import{V as U}from"./VIcon.518cdeb6.js";import{F as x}from"./FButton.da03e124.js";import{i as _,R as W,u as Z,a as Q,g as X,B as Y,s as ee,E as te}from"./base64.cc90f32e.js";import{F as ne}from"./FQRCode.7a3d8252.js";import{V as oe}from"./VProgressCircular.6a9473f8.js";const se=v({name:"FAuthStep1",inheritAttrs:!1,props:{step:{type:Number,default:1},method:{type:String,default:""},authMethods:{type:Array,default:()=>["mixin"]},authMethodState:{type:Object,default:()=>({})}},emits:{close:()=>!0,auth:e=>!0,"update:method":e=>!0,"update:step":e=>!0},setup(e,{emit:t}){const{t:a}=w(),{mdAndUp:n}=k(),s=K(),i=s.current.value.colors.greyscale_3,d=z(()=>s.name.value==="dark"),f=[{needNextStep:!e.authMethodState.metamask,value:"metamask",title:"MetaMask",bg:d.value?i:"#FFEEDD",logo:"https://static.fox.one/image/logo_metamask@40x40.png"},{needNextStep:!0,value:"mixin",title:"Mixin",bg:d.value?i:"#EBF8FF",logo:"https://static.fox.one/image/logo_mixin@40x40.png"},{needNextStep:!e.authMethodState.fennec,value:"fennec",title:"Fennec",bg:d.value?i:"#E6E7FD",logo:"https://static.fox.one/image/logo_fennec@40x40.png"},{needNextStep:!1,value:"walletconnect",title:"WalletConnect",bg:d.value?i:"#f5f5f5",logo:d.value?"https://static.fox.one/image/logo_walletconnect_dark@40x40.png":"https://static.fox.one/image/logo_walletconnect@40x40.png"},{needNextStep:!e.authMethodState.onekey,value:"onekey",title:"OneKey",bg:d.value?i:"#E9FEE6",logo:"https://static.fox.one/image/logo_onekey@40x40.png"}],p=c(()=>e.authMethods.map(u=>f.find(C=>C.value===u)).filter(u=>!!u),"getAuthMethodsMeta"),r=c(u=>{u.needNextStep?(t("update:method",u.value),t("update:step",2)):(t("close"),t("auth",{type:u.value}))},"handleAuth");return()=>o("div",{class:"f-auth-step1"},[o("div",{class:["f-auth-methods",{"f-auth-methods--mobile":!n.value}]},[p().map(u=>o("div",{key:u.value,style:{backgroundColor:u.bg},class:"f-auth-method",onClick:()=>r(u)},[o("span",{class:"f-auth-method__logo"},[o(T,{width:"40",height:"40",src:u.logo},null)]),o("span",{class:"f-auth-method__label"},[u.title])]))]),o("div",{class:"f-auth-hint"},[o(U,{size:"16",color:"warning",class:"f-auth-hint__horn"},{default:()=>[B("$horn")]}),o("span",{innerHTML:a("$vuetify.uikit.gas_fee_hint")},null)])])}});function ae(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!A(e)}c(ae,"_isSlot$2");const ie=v({name:"FAuthFennecInstall",inheritAttrs:!1,setup(){const{smAndDown:e}=k(),{t}=w(),a=c(()=>{const n="";window.open(n)},"handleInstall");return()=>{let n;return o("div",{class:["f-auth-fennec","f-auth-step2",{"f-auth-step2--small":e.value}]},[o("div",{class:"f-auth-step2__left"},null),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title"},[t("$vuetify.uikit.fennec_not_installed")]),o("div",{class:"f-auth-step2__subtitle"},[t("$vuetify.uikit.fennec_introduction")]),o(x,{color:"greyscale_1",onClick:a},ae(n=t("$vuetify.uikit.install"))?n:{default:()=>[n]})])])}}}),le=v({name:"FAuthMetamaskInstall",inheritAttrs:!1,setup(){const{smAndDown:e}=k(),{t}=w(),a=c(()=>{const n="https://metamask.io/download/";window.open(n)},"handleInstall");return()=>o("div",{class:["f-auth-metamask","f-auth-step2",{"f-auth-step2--small":e.value,"f-auth-metamask--mobile":!_()}]},[o("div",{class:"f-auth-step2__left"},null),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title",innerHTML:_()?t("$vuetify.uikit.metamask_not_installed"):t("$vuetify.uikit.metamask_not_installed_2")},null),o("div",{class:"f-auth-step2__subtitle",innerHTML:_()?t("$vuetify.uikit.metamask_introduction"):t("$vuetify.uikit.metamask_introduction_2")},null),o(x,{color:"greyscale_1",onClick:a,innerHTML:_()?t("$vuetify.uikit.install"):t("$vuetify.uikit.open_in_mixin")},null)])])}});function V(e,t){this.api=e,this.endpoint=t}c(V,"MixinClient");V.prototype={disconnect(){this.ws.close()},connect(e,t,a,n){const s=this;s.handled=!1,s.callback=e,s.ws=new W(s.endpoint,"Mixin-OAuth-1",{maxReconnectionDelay:5e3,minReconnectionDelay:1e3,reconnectionDelayGrowFactor:1.2,connectionTimeout:8e3,maxRetries:1/0,debug:!1}),s.ws.addEventListener("message",function(i){if(s.handled)return;const d=new FileReader;d.onload=function(){const f=Z(new Uint8Array(this.result),{to:"string"}),p=JSON.parse(f);if(s.callback(p)){s.handled=!0;return}setTimeout(function(){s.sendRefreshCode(t,a,n,p.data)},1e3)},d.readAsArrayBuffer(i.data)}),s.ws.addEventListener("open",function(i){s.sendRefreshCode(t,a,n)})},sendRefreshCode(e,t,a,n){const s=this;s.handled||s.send({id:Q.v4().toUpperCase(),action:"REFRESH_OAUTH_CODE",params:{client_id:e,scope:t,code_challenge:a,authorization_id:n?n.authorization_id:""}})},send(e){try{this.ws.send(X(JSON.stringify(e)))}catch(t){t instanceof DOMException||console.error(t)}}};function R(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}c(R,"base64URLEncode");function ue(e){let t="";const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}c(ue,"generateRandomString");function re(){const e=ue(32),t=R(Y.encode(e)),a=R(ee(e).toString(te));return{verifier:t,challenge:a}}c(re,"generateCodePair");function H(e,t=!1,a,n={}){const[s,i]=t?["https://xuexi-api.firesbox.com","wss://xuexi-blaze.firesbox.com"]:["https://api.mixin.one","wss://blaze.mixin.one"],d=a[0]||s,f=a[1]||i,p=new V(d,f);let r=!1;const{challenge:u="",verifier:C=""}=e.pkce?re():{},l=c(h=>{var S,F,E,$,I;const g=h.data;if(((S=h==null?void 0:h.error)==null?void 0:S.code)===400||((F=h==null?void 0:h.error)==null?void 0:F.code)===10002)return(E=n.onError)==null||E.call(n,h==null?void 0:h.error),!0;if(!g)return!1;if(g.authorization_code.length>16)return e.pkce?fetch(d+"/oauth/token",{method:"post",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:e.clientId,code_verifier:C,code:g.authorization_code})}).then(m=>m.json()).then(m=>{var L,D,O;const b=(L=m==null?void 0:m.data)==null?void 0:L.access_token;b?(D=n.onSuccess)==null||D.call(n,b):(O=n.onError)==null||O.call(n,{description:"Get PKCE access token error"})}).catch(()=>{var m;(m=n.onError)==null||m.call(n,{description:"Get PKCE access token error"})}):($=n.onSuccess)==null||$.call(n,g.authorization_code),!0;if(N()){if(r)return!1;window.location.href="mixin://codes/"+g.code_id,r=!0}else(I=n.onShowUrl)==null||I.call(n,"https://mixin.one/codes/"+g.code_id);return!1},"handler");return p.connect(l,e.clientId,e.scope,u),p}c(H,"authorize");function j(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!A(e)}c(j,"_isSlot$1");const ce=v({name:"FAuthMixinMessenger",inheritAttrs:!1,props:{clientId:{type:String,default:""},scope:{type:String,default:""},pkce:{type:Boolean,default:!1},isFiresbox:{type:Boolean,default:!1},hosts:{type:Array,default:()=>[]}},emits:{auth:e=>!0,error:e=>!0,close:()=>!0},setup(e,{attrs:t,emit:a}){const{smAndDown:n}=k(),{t:s}=w(),i=y(""),d=y(null),f=c(()=>{const r="https://mixin.one/mm";window.open(r)},"handleInstall"),p=c(()=>{window.location.href=i.value},"handleOpenInApp");return q(()=>{d.value=H({clientId:e.clientId,scope:e.scope,pkce:e.pkce},e.isFiresbox,e.hosts,{onShowUrl:r=>i.value=r,onError:r=>a("error",r),onSuccess:r=>{var u;a("close"),(u=d.value)==null||u.disconnect(),e.pkce?a("auth",{type:"mixin",token:r}):a("auth",{type:"mixin",code:r})}})}),()=>{let r,u;return o("div",{class:`f-auth-mixin f-auth-step2 ${n.value&&"f-auth-step2--small"}`},[o("div",{class:"f-auth-step2__left"},[i.value?o("div",{class:"f-auth-step2__qr-wrapper"},[o(ne,{class:"f-auth-step2__qr-code",text:i.value,size:182},null),o(T,{class:"f-auth-step2__qr-logo",height:"32",width:"32",src:"https://static.fox.one/image/icon_mixin@32x32.png"},null)]):o(oe,{width:3,indeterminate:!0,color:"black",class:"d-flex f-auth-step2__loading"},null)]),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title"},[s("$vuetify.uikit.scan_to_connect")]),o("div",{class:"f-auth-step2__subtitle"},[o("span",{innerHTML:s("$vuetify.uikit.mixin_connect_detail",["<a class='f-auth-step2__link' href='https://mixin.one/messenger'>Mixin Messenger<svg width='14' height='14' viewBox='0 0 14 14' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M12.2068 1.79276C10.2975 -0.116585 7.2018 -0.116585 5.29246 1.79276L4.64288 2.44234C4.25236 2.83286 4.25236 3.46603 4.64288 3.85655C5.03341 4.24707 5.66657 4.24707 6.0571 3.85655L6.70667 3.20698C7.83497 2.07868 9.6643 2.07868 10.7926 3.20698C11.9209 4.33528 11.9209 6.16461 10.7926 7.29291L10.1425 7.94304C9.75195 8.33357 9.75194 8.96673 10.1425 9.35726C10.533 9.74778 11.1662 9.74778 11.5567 9.35726L12.2068 8.70712C14.1162 6.79778 14.1162 3.70211 12.2068 1.79276Z' fill='#076aff'/><path d='M3.85726 6.05638C4.24779 5.66586 4.24779 5.03269 3.85726 4.64217C3.46674 4.25165 2.83357 4.25165 2.44305 4.64217L1.79236 5.29286C-0.116985 7.2022 -0.116985 10.2979 1.79236 12.2072C3.70171 14.1166 6.79738 14.1166 8.70672 12.2072L9.35713 11.5568C9.74765 11.1663 9.74765 10.5331 9.35713 10.1426C8.9666 9.75207 8.33344 9.75207 7.94291 10.1426L7.29251 10.793C6.16421 11.9213 4.33488 11.9213 3.20658 10.793C2.07828 9.6647 2.07828 7.83537 3.20658 6.70707L3.85726 6.05638Z' fill='#076aff'/><path d='M8.20674 7.2071C8.59727 6.81658 8.59727 6.18341 8.20674 5.79289C7.81622 5.40237 7.18305 5.40237 6.79253 5.79289L5.73187 6.85355C5.34134 7.24408 5.34134 7.87724 5.73187 8.26776C6.12239 8.65829 6.75556 8.65829 7.14608 8.26776L8.20674 7.2071Z' fill='#076aff'/></svg></a>"])},null)]),o("div",{class:"f-auth-step2__actions"},[o(x,{color:"greyscale_1",onClick:p},j(r=s("$vuetify.uikit.open_in_mixin"))?r:{default:()=>[r]}),o(x,{color:"greyscale_6",onClick:f},j(u=s("$vuetify.uikit.install"))?u:{default:()=>[u]})])])])}}});function de(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!A(e)}c(de,"_isSlot");const fe=v({name:"FAuthOnekeyInstall",inheritAttrs:!1,setup(){const{smAndDown:e}=k(),{t}=w(),a=c(()=>{const n="https://onekey.so/download?client=browserExtension";window.open(n)},"handleInstall");return()=>{let n;return o("div",{class:["f-auth-onekey","f-auth-step2",{"f-auth-step2--small":e.value,"f-auth-onekey--mobile":!_}]},[o("div",{class:"f-auth-step2__left"},null),o("div",{class:"f-auth-step2__right"},[o("div",{class:"f-auth-step2__title",innerHTML:_()?t("$vuetify.uikit.onekey_not_installed"):t("$vuetify.uikit.onekey_not_installed_2")},null),o("div",{class:"f-auth-step2__subtitle",innerHTML:_()?t("$vuetify.uikit.onekey_introduction"):t("$vuetify.uikit.onekey_introduction_2")},null),o(x,{color:"greyscale_1",onClick:a},de(n=t("$vuetify.uikit.install"))?n:{default:()=>[n]})])])}}}),he=v({name:"FAuthStep2",inheritAttrs:!1,props:{method:{type:String,default:""},clientId:{type:String,default:""},scope:{type:String,default:""},pkce:{type:Boolean,default:!1},isFiresbox:{type:Boolean,default:!1},hosts:{type:Array,default:()=>[]}},emits:{"update:step":e=>!0,auth:e=>!0,error:e=>!0,close:()=>!0},setup(e,{emit:t,attrs:a}){const n=c(()=>{switch(e.method){case"fennec":return ie;case"metamask":return le;case"onekey":return fe;default:return ce}},"getComponent"),s=z(()=>({wrapper:n()}));return()=>o("div",{class:"f-auth-step2"},[o(s.value.wrapper,M(e,{onAuth:i=>t("auth",i),onError:i=>t("error",i),onClose:()=>t("close")}),null),o(x,{icon:!0,size:"32",class:"f-auth-step2__back",onClick:()=>t("update:step",1)},{default:()=>[o(U,{color:"black"},{default:()=>[B("$back")]})]})])}}),Fe=v({name:"FAuthMethodModal",props:{authMethods:{type:Array,default:()=>["mixin"]},authMethodState:{type:Object,default:()=>({})},clientId:{type:String,default:""},scope:{type:String,default:""},isFiresbox:{type:Boolean,default:!1},hosts:{type:Array,default:()=>[]},pkce:{type:Boolean,default:!1}},emits:{auth:e=>!0,error:e=>!0,destroy:()=>!0},setup(e,{emit:t,expose:a}){const{t:n}=w(),s=y(!1),i=y(1),d=y(null),f=y(""),p=c(()=>o("div",{class:"f-auth-methods__wrapper"},[i.value===1?o(se,M(e,{step:i.value,"onUpdate:step":l=>i.value=l,method:f.value,"onUpdate:method":l=>f.value=l,onClose:r,onAuth:l=>t("auth",l),onError:l=>t("error",l)}),null):o(he,M(e,{step:i.value,"onUpdate:step":l=>i.value=l,method:f.value,"onUpdate:method":l=>f.value=l,onClose:r,onAuth:l=>t("auth",l),onError:l=>t("error",l)}),null)]),"content"),r=c(()=>{s.value=!1},"close");return G(()=>s.value,c(l=>{var h;l||(i.value=1,f.value="",s.value=!1,r(),t("destroy"),(h=d.value)==null||h.disconnect())},"handleDialogChange")),a({show:c(()=>{N()?d.value=H({clientId:e.clientId,scope:e.scope,pkce:e.pkce},e.isFiresbox,e.hosts,{onError:l=>t("error",l),onSuccess:l=>{e.pkce?t("auth",{type:"mixin",token:l}):t("auth",{type:"mixin",code:l})}}):s.value=!0},"show"),close:r}),()=>o(J,{modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,title:i.value===1?n("$vuetify.uikit.connect_wallet"):"","max-width":"628"},{default:()=>p()})}});export{Fe as F};
//# sourceMappingURL=FAuthMethodModal.b6409d0e.js.map
